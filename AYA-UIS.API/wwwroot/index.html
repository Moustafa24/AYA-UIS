<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Academic Schedules Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        input, button {
            margin: 5px 0;
        }

        img {
            max-width: 200px;
            margin: 5px;
            display: block;
        }

        .schedule {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>Test Academic Schedules API</h1>

    <!-- Form رفع صورة -->
    <h2>Upload Academic Schedule</h2>
    <form id="uploadForm">
        <input type="text" id="fileName" placeholder="Enter schedule name" required /><br>
        <input type="file" id="fileInput" accept="image/*" /><br>
        <button type="submit">Upload</button>
    </form>

    <hr>

    <!-- Show schedules -->
    <h2>All Schedules</h2>
    <div id="schedulesList"></div>

    <script>
        const apiBase = 'https://localhost:5001/api/AcademicSchedules'; // غيرها حسب مشروعك

        // رفع صورة
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const fileName = document.getElementById('fileName').value;
            const fileInput = document.getElementById('fileInput').files[0];

            const formData = new FormData();
            formData.append('FileName', fileName);
            if (fileInput) formData.append('file', fileInput);

            try {
                const res = await fetch(`${apiBase}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) throw new Error('Upload failed');

                const schedule = await res.json();
                alert(`Uploaded: ${schedule.fileName}`);
                loadSchedules(); // تحديث القائمة
            } catch (err) {
                alert(err.message);
            }
        });

        // جلب كل الـ schedules
        async function loadSchedules() {
            const container = document.getElementById('schedulesList');
            container.innerHTML = '';

            try {
                const res = await fetch(apiBase);
                const schedules = await res.json();

                schedules.forEach(s => {
                    const div = document.createElement('div');
                    div.className = 'schedule';

                    div.innerHTML = `
                    <strong>${s.fileName}</strong><br>
                    ${s.url ? `<img src="https://localhost:5001${s.url}" />` : ''}
                    <button onclick="deleteSchedule('${s.fileName}')">Delete</button>
                `;
                    container.appendChild(div);
                });
            } catch (err) {
                container.innerHTML = 'Error loading schedules';
            }
        }

        // حذف schedule
        async function deleteSchedule(fileName) {
            if (!confirm(`Are you sure you want to delete "${fileName}"?`)) return;

            try {
                const res = await fetch(`${apiBase}/${fileName}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Delete failed');
                alert(`Deleted: ${fileName}`);
                loadSchedules();
            } catch (err) {
                alert(err.message);
            }
        }

        // تحميل القائمة أول مرة
        loadSchedules();
    </script>

</body>
</html>
